---
title: "Analyses"
output:
  html_document:
    toc: TRUE
    toc_float:
      collapsed: FALSE
    toc_depth: 2
    # code_folding: hide
bibliography      : 
  - "bibliography/r-references.bib"
  - "bibliography/references.bib"
  # pdf_document:
  #   toc: TRUE
---

```{r knitr-setup, include=F}
set.seed(170819)
knitr::opts_chunk$set(warning=F, echo=T, error=F, message=F, cache = T, 
                      tidy=T, dev = 'pdf', cache.extra = knitr::rand_seed)
options(digits = 3, width = 140, scipen=999)
```

# Set-up

Load packages, and make repo replicable.

```{r r-setup, results='hide'}
# install packages
# devtools::install_github("https://github.com/tdienlin/td")

# define packages
packages <- c("brms", "corrplot", "devtools", "GGally", "ggplot2", 
              "gridExtra", "haven", "kableExtra", "knitr", 
              "lavaan", "lme4", "magrittr", "mice", "MVN", "PerFit", 
              "psych", "quanteda.textstats",
              "pwr", "semPlot", "semTools", "tidyverse")

# renv::install(packages)
# renv::install("tdienlin/td@v.0.0.2.5")  # uncomment to install
# renv::install("crsh/papaja@v0.1.0.9997")  # uncomment to install

# load packages
lapply(c(packages, "td"), library, character.only = TRUE)
```

## Custom functions

Find Variables in dataset.

```{r}
find_var <- function(name, data = doc)(
  # finds the variables names for an item for each wave
    data %>% 
    filter(Label == name) %>% 
    select(variable) %>% 
    unlist() %>% 
    set_names(sub("\\_.*", "", .))
)
```

Extract characteristics from fitted lmer models.

```{r}
get_specs <- function(model){
    # Get mean, max, and min values

    dat <- coefficients(model)$wave
    specs <- data.frame(
    sd = attr(VarCorr(model), "sc"),
    min = min(dat),
    max = max(dat),
    mean = mean(dat$`(Intercept)`)
  )
}
```

Get data from fitted lmer objects

```{r}
get_dat <- function(model){
  coefficients(model)$wave %>% 
  tibble::rownames_to_column("wave") %>% 
  rename(value = "(Intercept)") %>% 
  mutate(wave = as.integer(.$wave),
         value = as.numeric(.$value)) 
} 
```

Make graph of variables' development.

```{r}
make_graph <- function(model, title, ll, ul, line = FALSE, labels = FALSE, lmer=TRUE, legend=TRUE){

    if(isTRUE(lmer)){
      dat <- get_dat(model)
    } else{
    dat <- model
  }
    
  graph <- 
    ggplot(dat, aes(wave, value, color = dimension)) +
    {if(legend) theme(
      legend.position = c(0.85, 0.8),
      legend.title = element_blank()
      )} + 
    {if(!legend) theme(
      legend.position = "none"
    )} +
    theme(axis.title.x=element_blank()) +
    coord_cartesian(ylim = c(ll, ul)) +
    ggtitle(title) +
    {if(line) geom_smooth(se = FALSE, method = 'loess')} +
    # geom_point() +
    scale_color_manual(values=c("dodgerblue3", "deepskyblue2", "magenta2", "green2", "red"))
  graph
}
```

Make graph of effects

```{r}
make_graph_res <- function(data, sesoi = TRUE){
  ggplot(data, aes(x = estimate, y = iv)) + 
  scale_color_manual(values = c("grey40", "deepskyblue")) +
  geom_vline(xintercept = 0, lwd = .75, colour = "darkgrey") + 
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high),
                lwd = .75, height = .2
                , position = position_dodge(.6)
                ) +
  geom_point(size = 2
             , position = position_dodge(.6)
             ) +
  {if(sesoi) geom_vline(data=filter(data, dv=="Life satisfaction"), aes(xintercept=.3), colour="darkgrey", linetype = "dashed")} + 
  {if(sesoi) geom_vline(data=filter(data, dv=="Life satisfaction"), aes(xintercept=-.3), colour="darkgrey", linetype = "dashed")} + 
  {if(sesoi) geom_vline(data=filter(data, dv!="Life satisfaction"), aes(xintercept=.15), colour="darkgrey", linetype = "dashed")} + 
  {if(sesoi) geom_vline(data=filter(data, dv!="Life satisfaction"), aes(xintercept=-.15), colour="darkgrey", linetype = "dashed")} +
  theme(
    axis.title.y = element_blank(),
    plot.title = element_text(hjust = .5),
    panel.spacing = unit(.9, "lines"),
    text = element_text(size = 12),
    axis.text.y = element_text(hjust = 0)
    ) +
  facet_grid(rows = vars(type),
             cols = vars(dv),
             scales = "free",
             space = "free_y") 
}
```

# Data Wrangling

```{r}
doc <- read_csv("documentation/10094_vi_de_v4_0.csv")
d_raw <- read_csv("data/10094_da_de_v4_0.csv")
```

Identify the names of each item for each wave.

```{r}
# identify variable names of items, using custom function
health <- find_var("Gesundheitszustand") # wasn't collected at wave 21
aff_neg_1 <- find_var("Depressivitaet: einsam")
aff_neg_2 <- find_var("Depressivitaet: aergerlich")
aff_neg_3 <- find_var("Depressivitaet: so niedergeschlagen")
aff_neg_4 <- find_var("Depressivitaet: sehr nervoes")
aff_neg_5 <- find_var("Depressivitaet: aengstlich")
aff_neg_6 <- find_var("Depressivitaet: bedrueckt und traurig")
aff_pos_1 <- find_var("Depressivitaet: ruhig und gelassen")
aff_pos_2 <- find_var("Depressivitaet: gluecklich")
aff_pos_3 <- find_var("Depressivitaet: voller Energie")
act_wrk <- find_var("Zuhause verlassen: Arbeit")
act_spo <- find_var("Zuhause verlassen: Sport")
act_frn <- find_var("Zuhause verlassen: Freunde oder Verwandte treffen")
act_sho <- find_var("Zuhause verlassen: Essen einkaufen")
act_pet <- find_var("Zuhause verlassen: Haustier ausfuehren")
sat_dem <- find_var("Demokratiezufriedenheit: Oesterreich")
work_h <- find_var("Arbeitsstunden: Jetzt pro Woche")
work_homeoff <- find_var("Aenderung berufliche Situation: Home-Office")
hh_income <- find_var("Aktuelles Haushaltseinkommen")
med_txt_kro <- find_var("Mediennutzung: Kronen Zeitung oder www.krone.at")
med_txt_sta <- find_var("Mediennutzung: Der Standard oder derstandard.at")
med_txt_pre <- find_var("Mediennutzung: Die Presse oder diepresse.com")
med_txt_oes <- find_var("Mediennutzung: Oesterreich oder oe24.at")
med_txt_kur <- find_var("Mediennutzung: Kurier oder kurier.at")
med_txt_slz <- find_var("Mediennutzung: Salzburger Nachrichten oder salzburg.at")
med_txt_son <- find_var("Mediennutzung: Sonstige oesterreichische Tageszeitungen")
med_vid_orf <- find_var("Mediennutzung: ORF (Nachrichten)")
med_vid_pri <- find_var("Mediennutzung: Privatfernsehen (Nachrichten)")
soc_med_fb <- find_var("Soziale Medien: Facebook")
soc_med_tw <- find_var("Soziale Medien: Twitter")
soc_med_ig <- find_var("Soziale Medien: Instagram")
soc_med_yt <- find_var("Soziale Medien: Youtube")
soc_med_wa <- find_var("Soziale Medien: WhatsApp")
soc_med_read <- find_var("Soziale Medien Aktivitaet: Postings zu Corona anderer lesen")
soc_med_like_share <- find_var("Soziale Medien Aktivitaet: Postings liken, teilen oder retweeten")
soc_med_post <- find_var("Soziale Medien Aktivitaet: selber Postings zu Corona verfassen")
life_sat <- find_var("Lebenszufriedenheit")
risk_prop <- find_var("Risikobereitschaft")
loc_cntrl_int_1 <- find_var("Psychologie: habe Leben selbst in der Hand")
loc_cntrl_int_2 <- find_var("Psychologie: Belohnung durch Anstrengung")
loc_cntrl_int_3 <- find_var("Psychologie: Fremdbestimmung")
loc_cntrl_int_4 <- find_var("Psychologie: Schicksal")
```

Select variables.

```{r}
d_wide <- d_raw %>% 
  select(
    id = RESPID,
    gender = SD_GENDER,
    acc_bal = SD_ACCESS_BALCONY,
    acc_gar = SD_ACCESS_GARDEN,
    year_birth = SD_BIRTHYEAR,
    born_aus = SD_BORN_AUSTRIA,
    born_aus_prnts = SD_MIGR_BACKGR,
    county = SD_BULA,
    edu = SD_EDU,
    employment = SD_EMPLSTATUS_FEB2020,
    hh_adults = SD_HH_ADULTS,
    hh_child18 = SD_HH_CHILD18,
    hh_child17 = SD_HH_TEENS,
    hh_child14 = SD_HH_CHILD14,
    hh_child5 = SD_HH_CHILD5,
    hh_child2 = SD_HH_CHILD2,
    hh_oldfam = SD_HH_OLDERFAM,
    hh_outfam = SD_HH_OUTERFAM,
    hh_partner = SD_HH_PARTNER,
    # hh_income = SD_HHINCOME_FEB2020,
    home_sqm = SD_HOME_SQM,
    home_owner = SD_HOMEOWNER,
    # work_h = SD_WORKHOURS_FEB2020,
    health = all_of(health),
    life_sat = all_of(life_sat),
    aff_neg_1 = all_of(aff_neg_1),
    aff_neg_2 = all_of(aff_neg_2),
    aff_neg_3 = all_of(aff_neg_3),
    aff_neg_4 = all_of(aff_neg_4),
    aff_neg_5 = all_of(aff_neg_5),
    aff_neg_6 = all_of(aff_neg_6),
    aff_pos_1 = all_of(aff_pos_1),
    aff_pos_2 = all_of(aff_pos_2),
    aff_pos_3 = all_of(aff_pos_3),
    act_wrk = all_of(act_wrk),
    act_spo = all_of(act_spo),
    act_frn = all_of(act_frn),
    act_sho = all_of(act_sho),
    act_pet = all_of(act_pet),
    sat_dem = all_of(sat_dem),
    sat_dem = all_of(sat_dem),
    work_h = all_of(work_h),
    work_homeoff = all_of(work_homeoff),
    hh_income = all_of(hh_income),
    med_txt_kro = all_of(med_txt_kro),
    med_txt_sta = all_of(med_txt_sta),
    med_txt_pre = all_of(med_txt_pre),
    med_txt_oes = all_of(med_txt_oes),
    med_txt_kur = all_of(med_txt_kur),
    med_txt_slz = all_of(med_txt_slz),
    med_txt_son = all_of(med_txt_son),
    med_vid_orf = all_of(med_vid_orf),
    med_vid_pri = all_of(med_vid_pri),
    soc_med_fb = all_of(soc_med_fb),
    soc_med_tw = all_of(soc_med_tw),
    soc_med_ig = all_of(soc_med_ig),
    soc_med_yt = all_of(soc_med_yt),
    soc_med_wa = all_of(soc_med_wa),
    soc_med_like_share = all_of(soc_med_like_share),
    soc_med_read = all_of(soc_med_read),
    soc_med_post = all_of(soc_med_post),
    risk_prop = all_of(risk_prop),
    loc_cntrl_int_1 = all_of(loc_cntrl_int_1),
    loc_cntrl_int_2 = all_of(loc_cntrl_int_2),
    loc_cntrl_int_3 = all_of(loc_cntrl_int_3),
    loc_cntrl_int_4 = all_of(loc_cntrl_int_4)
  )

# rename variables
# names(d_wide) <- sub("\\.\\.\\.", "ยง", names(d_wide)) # replace "..." with "_"
```

Recode Variables

```{r}
d_wide %<>%
  mutate_at(vars(everything(.)), funs(na_if(., 88))) %>%
  mutate_at(vars(everything(.)), funs(na_if(., 99))) %>%
  mutate(
    male = 2 - .$gender,
    age = 2021 - .$year_birth,
    res_vienna = recode(.$county, `8` = 1L, .default = 0L,),
    born_aus = 2 - .$born_aus,
    home_owner = 2 - .$home_owner,
    employment_fac = factor(.$employment, 
                           # labels = c("Unselbststaendig erwerbstaetig (auch Lehrling), Privatwirtschaft",
                           #            "Unselbststaendig erwerbstaetig (auch Lehrling), Oeffentlicher Dienst",
                           #            "Selbststaendig erwerbstaetig",
                           #            "Arbeitslos",
                           #            "Pensionist*in",
                           #            "Ausschliesslich haushaltsfuehrend",
                           #            "Schueler/in, Student/in, Bildungskarenz",
                           #            "Sonstiges (Dauerhaft arbeitsunfaehig oder Praesenz-/Zivildiener)",
                           #            "In Elternkarenz")
                           labels = c("Employed industrie",
                                      "Employed public service",
                                      "Self-employed",
                                      "Unemployed",
                                      "Retired",
                                      "Housekeeping",
                                      "Student",
                                      "Incapacitated",
                                      "Parental Leave")
                           ),
    edu_fac = factor(.$edu,
                     # labels = c("Volksschule oder weniger", 
                     #            "Hauptschule oder AHS Unterstufe",
                     #            "Polytechnikum, BMS (Fachschule, z.B. HASCH)",
                     #            "Lehre, Berufsschule",
                     #            "AHS mit Matura",
                     #            "BHS mit Matura (z.B. HTL, HAK, HBLA etc.)",
                     #            "Hochschulverwandte Lehranstalt oder Kolleg",
                     #            "Bachelor",
                     #            "Magister / Master / Diplomingenieur / Fachhochschule",
                     #            "Doktor / PhD"),
                     labels = c("No degree", 
                                "Middle school",
                                "Vocational school",
                                "Technical school",
                                "High school",
                                "Applied high school",
                                "State college",
                                "Bachelor",
                                "Master",
                                "PhD")
                     ))
```

Make new documentation with selected variables.

```{r}
doc_selected <- filter(doc, variable %in% c(
  "RESPID",
  "SD_GENDER",
  "SD_ACCESS_BALCONY",
  "SD_ACCESS_GARDEN",
  "SD_BIRTHYEAR",
  "SD_BORN_AUSTRIA",
  "SD_MIGR_BACKGR",
  "SD_BULA",
  "SD_EDU",
  "SD_EMPLSTATUS_FEB2020",
  "SD_HH_ADULTS",
  "SD_HH_CHILD18",
  "SD_HH_TEENS",
  "SD_HH_CHILD14",
  "SD_HH_CHILD5",
  "SD_HH_CHILD2",
  "SD_HH_OLDERFAM",
  "SD_HH_OUTERFAM",
  "SD_HH_PARTNER",
  "SD_HHINCOME_FEB2020",
  "SD_HOME_SQM",
  "SD_HOMEOWNER",
  "SD_WORKHOURS_FEB2020",
  health[1],
  life_sat[1],
  aff_neg_1[1],
  aff_neg_2[1],
  aff_neg_3[1],
  aff_neg_4[1],
  aff_neg_5[1],
  aff_neg_6[1],
  aff_pos_1[1],
  aff_pos_2[1],
  aff_pos_3[1],
  act_wrk[1],
  act_spo[1],
  act_frn[1],
  act_sho[1],
  act_pet[1],
  sat_dem[1],
  work_h[1],
  work_homeoff[1],
  hh_income[1],
  med_txt_kro[1],
  med_txt_sta[1],
  med_txt_pre[1],
  med_txt_oes[1],
  med_txt_kur[1],
  med_txt_slz[1],
  med_txt_son[1],
  med_vid_orf[1],
  med_vid_pri[1],
  soc_med_fb[1],
  soc_med_tw[1],
  soc_med_ig[1],
  soc_med_yt[1],
  soc_med_wa[1],
  soc_med_like_share[1],
  soc_med_post[1],
  soc_med_read[1],
  risk_prop[1],
  loc_cntrl_int_1[1],
  loc_cntrl_int_2[1],
  loc_cntrl_int_3[1],
  loc_cntrl_int_4[1]
  ))
```

Make data from wide to long.

```{r}
d_long <-
  d_wide %>% 
  pivot_longer(
    cols = health...W1:loc_cntrl_int_4...W9,
    names_to = "item",
    values_to = "value"
  ) %>% 
  separate(item, c("item", "wave"), sep = "\\.\\.\\.", extra = "merge") %>% 
  pivot_wider(names_from = "item", values_from = "value")
```

Filter waves without data

```{r eval=F}
d_long_test <- d_long %>%
  filter(!is.na(.[vars_varying]))
```

Recode values

```{r}
# recode such that higher values imply more strength / align with wording
d_long %<>% 
  mutate_at(vars(med_txt_kro:med_vid_pri, health, sat_dem, soc_med_fb:soc_med_post), 
            funs(recode(., `1` = 5L, `2` = 4L, `3` = 3L, `4` = 2L, `5` = 1L))) %>% 
  mutate_at(vars(loc_cntrl_int_1:loc_cntrl_int_4), 
            funs(recode(., `1` = 4L, `2` = 3L, `3` = 2L, `4` = 1L))) %>% 
  mutate_at(vars(born_aus_prnts), 
            funs(recode(., `3` = 0L, `2` = 2L, `1` = 1L)))

# recode inverted items
d_long %<>%
  mutate_at(vars(loc_cntrl_int_3, loc_cntrl_int_4), 
            funs(recode(., `1` = 4L, `2` = 3L, `3` = 2L, `4` = 1L)))

# recode other
d_long %<>%
  mutate(
    wave = gsub("W", "", .$wave) %>% as.integer(),
    id = as.integer(id)
  )
```

Order dataset. First id, then wave.

```{r}
d_long %<>%
  arrange(id, wave)
```

Create means for scales

```{r}
d_long %<>%
  mutate(aff_pos_m = rowMeans(select(., aff_pos_1 : aff_pos_3)),
         aff_neg_m = rowMeans(select(., aff_neg_1 : aff_neg_6)),
         loc_cntrl_int_m = rowMeans(select(., loc_cntrl_int_1 : loc_cntrl_int_4)))
```

Create mean values for each person (between), and unique changes per wave (within).

```{r}
d_long %<>% 
  group_by(id) %>% 
  mutate_at(vars(health:loc_cntrl_int_4, loc_cntrl_int_m), funs(b = mean(., na.rm = TRUE), w = . - mean(., na.rm = TRUE))) %>% 
  ungroup()
```

Create vectors with names

```{r}
# create vector of names
vars_varying <- names(select(d_long, "health_b":"loc_cntrl_int_4_w"))
predictors_varying <- select(d_long, "health_b":"loc_cntrl_int_4_w") %>% 
  select(-starts_with("aff_"), -starts_with("life_")) %>% 
  names()
```

# inspect data

```{r}
nas <- sapply(d_long, function(y) sum(length(which(is.na(y))))) %>% 
  order()
```

Inspect participants with NA as ID

```{r}
d_long_filtered <- d_long %>% filter(is.na(id))
d_raw_filtered <- d_raw %>% filter(is.na(.$RESPID))
```

# measures
## well-being
### life satisfaction

```{r}
model_life_sat <- lmer(life_sat ~ (1 | id) + (1 | wave), d_long)
summary(model_life_sat)
```

### positive affect

```{r}
model_aff_pos <- lmer(aff_pos_m ~ (1 | id) + (1 | wave), d_long)
summary(model_aff_pos)
```

### negative affect

```{r}
model_aff_neg <- lmer(aff_neg_m ~ (1 | id) + (1 | wave), d_long)
summary(model_aff_neg)
```

## Social media use
### reading

```{r}
model_soc_med_read <- lmer(soc_med_read ~ (1 | id) + (1 | wave), d_long)
summary(model_soc_med_read)
```

### liking & sharing

```{r}
model_soc_med_like_share <- lmer(soc_med_like_share ~ (1 | id) + (1 | wave), d_long)
summary(model_soc_med_like_share)
```

### posting

```{r}
model_soc_med_post <- lmer(soc_med_post ~ (1 | id) + (1 | wave), d_long)
summary(model_soc_med_post)
```

## Social media channels
### Facebook

```{r}
model_soc_med_fb <- lmer(soc_med_fb ~ (1 | id) + (1 | wave), d_long)
summary(model_soc_med_fb)
```

### Twitter

```{r}
model_soc_med_tw <- lmer(soc_med_tw ~ (1 | id) + (1 | wave), d_long)
summary(model_soc_med_tw)

# Bayesian Approach
# model_soc_med_tw <- brm(soc_med_tw ~ (1 | id) + (1 | wave), d_long
# Also throws a warning
# model_soc_med_tw <- brm(soc_med_tw ~ (1 | id) + (1 | wave), d_long, control=list(adapt_delta=0.82))
# Currently doesn't work, likely for lack of memory
```

Interestingly, lme4 throws a warning, likely because there is too little variance across waves, while little variation measure itself. Let's inspect the raw means.

```{r}
soc_med_tw_m <- d_long %>% group_by(wave) %>% summarise(value = mean(soc_med_tw, na.rm = T))
soc_med_tw_m
```

Inspecting the means shows that the data are intact, only that the estimation didn't fully work.

### Instagram

```{r}
model_soc_med_ig <- lmer(soc_med_ig ~ (1 | id) + (1 | wave), d_long)
summary(model_soc_med_ig)
```

### WhatsApp

```{r}
model_soc_med_wa <- lmer(soc_med_wa ~ (1 | id) + (1 | wave), d_long)
summary(model_soc_med_wa)
```

### YouTube

```{r}
model_soc_med_yt <- lmer(soc_med_yt ~ (1 | id) + (1 | wave), d_long)
summary(model_soc_med_yt)
```

## figure

Display the results in a combined figure.

```{r}
fig_desc_dat <- data.frame(
  rbind(
    data.frame(type = "Life satisfaction", dimension = "Life satisfaction", get_dat(model_life_sat)),
    data.frame(type = "Affect", dimension = "Positive", get_dat(model_aff_pos)),
    data.frame(type = "Affect", dimension = "Negative", get_dat(model_aff_neg)),
    data.frame(type = "Social media use", dimension = "Reading", get_dat(model_soc_med_read)),
    data.frame(type = "Social media use", dimension = "Liking & Sharing", get_dat(model_soc_med_like_share)),
    data.frame(type = "Social media use", dimension = "Posting", get_dat(model_soc_med_post)),
    data.frame(type = "Social media channel", dimension = "Facebook", get_dat(model_soc_med_fb)),
    data.frame(type = "Social media channel", dimension = "Twitter", get_dat(model_soc_med_tw)),
    data.frame(type = "Social media channel", dimension = "Instagram", get_dat(model_soc_med_ig)),
    data.frame(type = "Social media channel", dimension = "WhatsApp", get_dat(model_soc_med_wa)),
    data.frame(type = "Social media channel", dimension = "YouTube", get_dat(model_soc_med_yt))
  ) %>% 
    mutate(
      type = factor(.$type, levels = c("Life satisfaction", "Affect", "Social media use", "Social media channel")),
      dimension = factor(.$dimension, levels = c("Life satisfaction", "Positive", "Negative", "Reading", "Liking & Sharing", "Posting", "Facebook", "Twitter", "Instagram", "WhatsApp", "YouTube"))
      )
)

fig_desc_life_sat <- make_graph(
  fig_desc_dat %>% filter(type == "Life satisfaction"), 
  title = "Life satisfaction", 
  ll = 0, ul = 10, 
  lmer = FALSE, 
  line = TRUE,
  legend = FALSE
  )

fig_desc_aff <- make_graph(
  fig_desc_dat %>% filter(type == "Affect"), 
  title = "Affect", 
  ll = 1, ul = 5, 
  lmer = FALSE, 
  line = TRUE
  )

fig_desc_soc_med_use <- make_graph(
  fig_desc_dat %>% filter(type == "Social media use"), 
  title = "Social media use", 
  ll = 1, ul = 5, 
  lmer = FALSE, 
  line = TRUE
  )

fig_desc_soc_med_channel <- make_graph(
  fig_desc_dat %>% filter(type == "Social media channel"), 
  title = "Social media channel", 
  ll = 1, ul = 5, 
  lmer = FALSE, 
  line = TRUE
  )

fig_desc <- grid.arrange(fig_desc_life_sat, fig_desc_aff, 
                         fig_desc_soc_med_use, fig_desc_soc_med_channel,
                         nrow = 2, ncol = 2)

ggsave("figures/fig_descriptives.pdf", 
       width = 10, height = 6,
       plot = fig_desc)
```

## table

```{r}
tab_desc_dat <- rbind(
    "Life satisfaction" = get_specs(model_life_sat),
    "Positive affect" = get_specs(model_aff_pos),
    "Negative affect" = get_specs(model_aff_neg),
    "Read" = get_specs(model_soc_med_read),
    "Like & share" = get_specs(model_soc_med_like_share),
    "Posting" = get_specs(model_soc_med_post),
    "Facebook" = get_specs(model_soc_med_fb),
    "Twitter" = c(sd = get_specs(model_soc_med_tw)$sd,
                  min = min(soc_med_tw_m$value, na.rm = TRUE),
                  max = max(soc_med_tw_m$value, na.rm = TRUE),
                  mean = mean(soc_med_tw_m$value, na.rm = TRUE)
                  ),
    "Instagram" = get_specs(model_soc_med_ig),
    "WhatsApp" = get_specs(model_soc_med_wa),
    "YouTube" = get_specs(model_soc_med_yt)
    )
```


# analyses
## life satisfaction

First, without control variables.

```{r}
model_life_sat_lmer_nco <- lmerTest::lmer(life_sat ~ 
                            (1 | id) + (1 | wave) + 
                            soc_med_read_w + soc_med_like_share_w + soc_med_post_w + 
                            soc_med_fb_w + soc_med_ig_w + soc_med_wa_w + soc_med_yt_w + soc_med_tw_w +
                            soc_med_read_b + soc_med_like_share_b + soc_med_post_b + 
                            soc_med_fb_b + soc_med_ig_b + soc_med_wa_b + soc_med_yt_b + soc_med_tw_b,
                data = d_long)
summary(model_life_sat_lmer_nco)
```

Now with control variables.

```{r}
model_life_sat_lmer <- lmerTest::lmer(life_sat ~
                                        (1 | id) + (1 | wave) + 
                                        soc_med_read_w + soc_med_like_share_w + soc_med_post_w  + 
                                        soc_med_fb_w + soc_med_ig_w + soc_med_wa_w + soc_med_yt_w + soc_med_tw_w +
                                        soc_med_read_b + soc_med_like_share_b + soc_med_post_b + 
                                        soc_med_fb_b + soc_med_ig_b + soc_med_wa_b + soc_med_yt_b + soc_med_tw_b +  
                                        age + male + born_aus + born_aus_prnts + edu_fac + employment_fac + health_b + 
                                        res_vienna + acc_bal + acc_gar + home_sqm + 
                                        # hh_income_b + # large dropout (900 obs)
                                        # hh_adults + # too much dropout
                                        # hh_child18 + hh_child17 + hh_child14 + hh_child5 + hh_child2 + hh_oldfam + hh_outfam + hh_partner + 
                                        # home_owner + # too much dropout
                                        med_txt_kro_b + med_txt_sta_b + med_txt_pre_b + med_txt_oes_b + med_txt_kur_b + med_txt_slz_b + med_txt_son_b + 
                                        med_vid_orf_b + med_vid_pri_b + 
                                        risk_prop_b + loc_cntrl_int_m_b + 
                                        act_wrk_w + act_spo_w + act_frn_w + act_sho_w + act_pet_w + 
                                        act_wrk_b + act_spo_b + act_frn_b + act_sho_b + act_pet_b +
                                        sat_dem_w + sat_dem_b 
                                      , data = d_long)
summary(model_life_sat_lmer)
```

```{r}
# + health_b + act_wrk_b + act_spo_b + act_frn_b + act_sho_b + act_pet_b + sat_dem_b + hh_income_b + med_txt_kro_b + med_txt_sta_b + med_txt_pre_b + med_txt_oes_b + med_txt_kur_b + med_txt_slz_b + med_txt_son_b + med_vid_orf_b + med_vid_pri_b + risk_prop_b + loc_cntrl_int_1_b + loc_cntrl_int_2_b + loc_cntrl_int_3_b + loc_cntrl_int_4_b + health_w + act_wrk_w + act_spo_w + act_frn_w + act_sho_w + act_pet_w + sat_dem_w + hh_income_w + med_txt_kro_w + med_txt_sta_w + med_txt_pre_w + med_txt_oes_w + med_txt_kur_w + med_txt_slz_w + med_txt_son_w + med_vid_orf_w + med_vid_pri_w + risk_prop_w + loc_cntrl_int_1_w + loc_cntrl_int_2_w + loc_cntrl_int_3_w + loc_cntrl_int_4_w
```


## Positive Affect

First, without control variables.

```{r}
model_aff_pos_lmer_nco <- lmerTest::lmer(aff_pos_m ~ 
                                        (1 | id) + (1 | wave) + 
                                        soc_med_read_w + soc_med_like_share_w + soc_med_post_w + 
                                        soc_med_fb_w + soc_med_ig_w + soc_med_wa_w + soc_med_yt_w + soc_med_tw_w +
                                        soc_med_read_b + soc_med_like_share_b + soc_med_post_b + 
                                        soc_med_fb_b + soc_med_ig_b + soc_med_wa_b + soc_med_yt_b + soc_med_tw_b
                                      , data = d_long)
summary(model_aff_pos_lmer_nco)
```


Now with control variables. 

```{r}
model_aff_pos_lmer <- lmerTest::lmer(aff_pos_m ~ 
                                        (1 | id) + (1 | wave) + 
                                        soc_med_read_w + soc_med_like_share_w + soc_med_post_w + 
                                        soc_med_fb_w + soc_med_ig_w + soc_med_wa_w + soc_med_yt_w + soc_med_tw_w +
                                        soc_med_read_b + soc_med_like_share_b + soc_med_post_b + 
                                        soc_med_fb_b + soc_med_ig_b + soc_med_wa_b + soc_med_yt_b + soc_med_tw_b +  
                                        age + male + born_aus + born_aus_prnts + edu_fac + employment_fac + health_b + 
                                        res_vienna + acc_bal + acc_gar + home_sqm + 
                                        # hh_income_b + # large dropout (900 obs)
                                        # hh_adults + # too much dropout
                                        # hh_child18 + hh_child17 + hh_child14 + hh_child5 + hh_child2 + hh_oldfam + hh_outfam + hh_partner + 
                                        # home_owner + # too much dropout
                                        med_txt_kro_b + med_txt_sta_b + med_txt_pre_b + med_txt_oes_b + med_txt_kur_b + med_txt_slz_b + med_txt_son_b + 
                                        med_vid_orf_b + med_vid_pri_b + 
                                        risk_prop_b + loc_cntrl_int_m_b + 
                                        act_wrk_w + act_spo_w + act_frn_w + act_sho_w + act_pet_w + 
                                        act_wrk_b + act_spo_b + act_frn_b + act_sho_b + act_pet_b +
                                        sat_dem_w + sat_dem_b 
                                      , data = d_long)
summary(model_aff_pos_lmer)
```

## Negative Affect

First, without control variables. 

```{r}
model_aff_neg_lmer_nco <- lmerTest::lmer(aff_neg_m ~ 
                                        (1 | id) + (1 | wave) + 
                                        soc_med_read_w + soc_med_like_share_w + soc_med_post_w + 
                                        soc_med_fb_w + soc_med_ig_w + soc_med_wa_w + soc_med_yt_w + soc_med_tw_w +
                                        soc_med_read_b + soc_med_like_share_b + soc_med_post_b + 
                                        soc_med_fb_b + soc_med_ig_b + soc_med_wa_b + soc_med_yt_b + soc_med_tw_b
                                      , data = d_long)
summary(model_aff_neg_lmer_nco)
```

Then, with control variables. 

```{r}
model_aff_neg_lmer <- lmerTest::lmer(aff_neg_m ~ 
                                        (1 | id) + (1 | wave) + 
                                        soc_med_read_w + soc_med_like_share_w + soc_med_post_w + 
                                        soc_med_fb_w + soc_med_ig_w + soc_med_wa_w + soc_med_yt_w + soc_med_tw_w +
                                        soc_med_read_b + soc_med_like_share_b + soc_med_post_b + 
                                        soc_med_fb_b + soc_med_ig_b + soc_med_wa_b + soc_med_yt_b + soc_med_tw_b +  
                                        age + male + born_aus + born_aus_prnts + edu_fac + employment_fac + health_b + 
                                        res_vienna + acc_bal + acc_gar + home_sqm + 
                                        # hh_income_b + # large dropout (900 obs)
                                        # hh_adults + # too much dropout
                                        # hh_child18 + hh_child17 + hh_child14 + hh_child5 + hh_child2 + hh_oldfam + hh_outfam + hh_partner + 
                                        # home_owner + # too much dropout
                                        med_txt_kro_b + med_txt_sta_b + med_txt_pre_b + med_txt_oes_b + med_txt_kur_b + med_txt_slz_b + med_txt_son_b + 
                                        med_vid_orf_b + med_vid_pri_b + 
                                        risk_prop_b + loc_cntrl_int_m_b + 
                                        act_wrk_w + act_spo_w + act_frn_w + act_sho_w + act_pet_w + 
                                        act_wrk_b + act_spo_b + act_frn_b + act_sho_b + act_pet_b +
                                        sat_dem_w + sat_dem_b 
                                      , data = d_long)
summary(model_aff_neg_lmer)
```

## figure

First, extract data.

```{r}
# get data
dat_fig_results <- 
  broom.mixed::tidy(model_aff_neg_lmer, conf.int = T) %>% 
  mutate(dv = "aff_neg") %>% 
  rbind(
    broom.mixed::tidy(model_aff_pos_lmer, conf.int = T) %>% 
    mutate(dv = "aff_pos")
  ) %>% 
  rbind(
    broom.mixed::tidy(model_life_sat_lmer, conf.int = T) %>% 
    mutate(dv = "life_sat")
  ) %>% 
  mutate(
    type = ifelse(grepl(".*_w.*", .$term), "within", "between"),
    iv = gsub("_(w|b)\\>", "", .$term)
         ) %>%
  mutate(
    type = factor(.$type, 
                  levels = c("within", "between")),
    dv = factor(.$dv, 
                levels = c("life_sat", "aff_pos", "aff_neg"),
                labels = c("Life satisfaction", "Positive affect", "Negative affect"))
  ) %>% 
  select(dv, iv, type, estimate, conf.low, conf.high, p.value)
```

Select social media types of activity, and make graph.

```{r}
# select Social Media type of activity
dat_fig_results_activity <- dat_fig_results %>%
  filter(iv %in% c("soc_med_read", "soc_med_like_share", "soc_med_post")) %>% 
  mutate(
    iv = factor(.$iv, 
                levels = c("soc_med_post", "soc_med_like_share", "soc_med_read"), 
                labels = c("Posting", "Liking & Sharing", "Reading"))
  )

# make figure
fig_results_activity <- make_graph_res(dat_fig_results_activity)

# safe figure
ggsave("figures/fig_results_activity.pdf", 
       width = 7, height = 4,
       plot = fig_results_activity)
```

Select social media channels and make figure.

```{r}
# select social media channel
dat_fig_results_channel <- dat_fig_results %>%
  filter(iv %in% c("soc_med_fb", "soc_med_ig", "soc_med_wa", "soc_med_yt", "soc_med_tw")) %>% 
  mutate(iv = factor(.$iv, levels = c("soc_med_yt", "soc_med_wa", "soc_med_ig", "soc_med_tw", "soc_med_fb"), labels = c("YouTube", "WhatsApp", "Instagram", "Twitter", "Facebook")))

# make figure
fig_results_channel <- make_graph_res(dat_fig_results_channel)

# save figure
ggsave("figures/fig_results_channel.pdf", 
       width = 7, height = 4,
       plot = fig_results_channel)
```

Select control variables and make graph.

```{r}
# select social media channel
dat_fig_results_control <- dat_fig_results %>%
  filter(iv %in% c("age", "male", "health", "home_sqm", "loc_cntrl_int_m", "employment_facUnemployed", "employment_facParental Leave", "act_spo", "sat_dem")) %>% 
  mutate(iv = factor(.$iv, levels = c("age", "male", "health", "home_sqm", "loc_cntrl_int_m", "employment_facUnemployed", "employment_facParental Leave", "act_spo", "sat_dem"), 
                     labels = c("Age", "Male", "Health", "Squaremeter home", "Internal locus of control", "Umemployed", "On parental leave", "Sport", "Satisfaction democracy")))

# make figure
fig_results_control <- make_graph_res(dat_fig_results_control, sesoi = FALSE)

# save figure
ggsave("figures/fig_results_control.pdf", 
       width = 7, height = 4,
       plot = fig_results_control)
```

```{r}
save.image("data/workspace.RData")
```
